# =====================================================================
# WellKorea ERP - Production Profile Configuration
# =====================================================================
# This profile is for PRODUCTION DEPLOYMENT.
# All sensitive values MUST come from environment variables.
# NO defaults provided - application will fail-fast if configs missing.
#
# Usage:
#   SPRING_PROFILES_ACTIVE=prod java -jar backend.jar
#   or in Docker: environment variable SPRING_PROFILES_ACTIVE=prod
#
# Required Environment Variables:
#   SPRING_DATASOURCE_URL
#   SPRING_DATASOURCE_USERNAME
#   SPRING_DATASOURCE_PASSWORD
#   JWT_SECRET (minimum 256 bits / 32 bytes)
#   MINIO_URL
#   MINIO_ACCESS_KEY
#   MINIO_SECRET_KEY
#   MINIO_BUCKET_NAME
#   MAIL_HOST (required if MAIL_PROVIDER=smtp)
#   MAIL_PORT (required if MAIL_PROVIDER=smtp)
#   MAIL_USERNAME (required if MAIL_PROVIDER=smtp)
#   MAIL_PASSWORD (required if MAIL_PROVIDER=smtp)
#
# Optional Environment Variables (for Microsoft Graph mail):
#   MAIL_PROVIDER (smtp or graph, default: smtp)
#   MICROSOFT_GRAPH_CLIENT_ID (required if MAIL_PROVIDER=graph)
#   MICROSOFT_GRAPH_CLIENT_SECRET (required if MAIL_PROVIDER=graph)
#   Note: Refresh token is configured via Admin Settings > Mail (in-app OAuth2)
# =====================================================================

spring:
  # Database Configuration
  # REQUIRED: All database properties must be set via environment variables
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}

  # JPA Configuration - Production hardening
  jpa:
    show-sql: false  # Never log SQL in production
    hibernate:
      ddl-auto: validate  # Never auto-create/update schema in production

  # Email Configuration
  # REQUIRED: All mail properties must be set via environment variables
  mail:
    host: ${MAIL_HOST}
    port: ${MAIL_PORT}
    username: ${MAIL_USERNAME}
    password: ${MAIL_PASSWORD}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true

  # Security - NO default credentials in production
  # All authentication MUST go through JWT tokens
  security:
    user:
      name: ${SPRING_SECURITY_USER_NAME:disabled-no-default-user-in-production}
      password: ${SPRING_SECURITY_USER_PASSWORD:disabled-no-default-password-in-production}

# Server Configuration
server:
  port: ${SERVER_PORT:8080}
  error:
    include-stacktrace: never  # NEVER expose stack traces in production
    include-message: always

# Security Configuration
# REQUIRED: Set SECURITY_CORS_ALLOWED_ORIGINS for production frontend URL
security:
  cors:
    allowed-origins: ${SECURITY_CORS_ALLOWED_ORIGINS}
    allowed-headers: ${SECURITY_CORS_ALLOWED_HEADERS:Authorization,Content-Type,Accept,X-Requested-With}
  swagger:
    enabled: false  # Swagger DISABLED in production

# JWT Configuration
# REQUIRED: JWT_SECRET must be set and be at least 256 bits (32 bytes)
jwt:
  secret: ${JWT_SECRET}
  expiration: ${JWT_EXPIRATION:86400000}  # Default: 24 hours

# Mail Provider Configuration
# Options: smtp (default), graph (Microsoft Graph API for Outlook)
mail:
  provider: ${MAIL_PROVIDER:smtp}

# Microsoft Graph Configuration (required when mail.provider=graph)
# For Outlook/Microsoft 365 email via OAuth2 (personal accounts like hotmail.com)
# Refresh token is configured via Admin Settings > Mail (in-app OAuth2 flow)
microsoft:
  graph:
    client-id: ${MICROSOFT_GRAPH_CLIENT_ID:}
    client-secret: ${MICROSOFT_GRAPH_CLIENT_SECRET:}

# MinIO Configuration
# REQUIRED: All MinIO properties must be set via environment variables
minio:
  url: ${MINIO_URL}
  access-key: ${MINIO_ACCESS_KEY}
  secret-key: ${MINIO_SECRET_KEY}
  bucket-name: ${MINIO_BUCKET_NAME}

# Actuator Configuration - Production security
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics  # Minimal endpoints exposed
  endpoint:
    health:
      show-details: when-authorized  # Only show details to authenticated users

# Logging Configuration - Production optimization
logging:
  level:
    root: INFO
    com.wellkorea.backend: INFO
    org.springframework.security: WARN
    org.hibernate.SQL: WARN
    org.springframework.web: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
